{% load crispy_forms_tags %}
{% load admin_static %}
<!DOCTYPE html>
<html>
<head>
    <link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet" />

    <script src="http://code.jquery.com/jquery-1.9.1.js">
    </script>
    <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js">
    </script>
    <script type="text/javascript" src="{% static "js/bootstrap-tab.js" %}"></script>
</head>

<style>
table {
    border-spacing: 0;
    width: 100%;
    border: 1px solid #ddd;
}

th {
    cursor: pointer;
}
                                                                
th, td {
    text-align: center;
    padding: 16px;
}

tr {
    line-height: 5px;
    min-height: 5px;
    height: 5px;
}

tr:nth-child(even) {
    background-color: #f2f2f2
}

.clickableRow td:hover {
    cursor: pointer;
}
</style>
<body>

<h1> Search Entries through OQMD </h1>
{% crispy form %}
{% if result %}
<h1> Results: </h1>
<div style="margin: 10px">
    <em> There are <b>{{count}}</b> entries found. </em>
    {% if sort_by %}
    <i>(Sorted by {{ sort_by }}) </i>
    {% endif %}
    <p>
    Display entries from {{ offset|add:"1"}} to {{ offset|add:limit }} on this page.
    </p>
</div>
<table id="ResultTable">
    <tr>
        <th onclick="sortTable(0, 'num')"> rank </th>
        <th onclick="sortTable(1, 'num')"> oqmd_id </th>
        <th onclick="sortTable(2, 'str')"> name </th>
        <th onclick="sortTable(3, 'str')"> generic </th>
        <th onclick="sortTable(4, 'str')"> spacegroup </th>
        <th onclick="sortTable(5, 'num')"> ntypes </th>
        <th onclick="sortTable(6, 'num')"> natoms </th>
        <th onclick="sortTable(7, 'num')"> energy_pa </th>
        <th onclick="sortTable(8, 'num')"> energy_pa_hse </th>
        <th onclick="sortTable(9, 'num')"> formation_energy </th>
        <th onclick="sortTable(10, 'num')"> formation_energy_hse </th>
        <th onclick="sortTable(11, 'num')"> band_gap </th>
        <th onclick="sortTable(12, 'num')"> band_gap_hse </th>
        <th onclick="sortTable(13, 'num')"> stability </th>
    </tr>
    {% for e in result %}
        <tr class=clickableRow">
        <td width="60"> {{ forloop.counter|add:offset}} </td>
        <td width="60"> {{ e.id }} </td>
        <td width="90"> <a href="/materials/entry/{{e.id}}">{{ e.name }}</a> </td>
        <td> {{ e.composition_generic }} </td>
        <td width="80"> {{ e.spacegroup }} </td>
        <td> {{ e.ntypes }} </td>
        <td> {{ e.natoms}} </td>
        <td> {{ e.energy_per_atom | floatformat:-3 }} </td>
        <td> {{ e.energy_per_atom_hse | floatformat:-3 }} </td>
        <td> {{ e.formation_energy | floatformat:-3 }} </td>
        <td> {{ e.formation_energy_hse | floatformat:-3 }} </td>
        <td> {{ e.band_gap | floatformat:-3 }} </td>
        <td> {{ e.band_gap_hse | floatformat:-3 }} </td>
        <td> {{ e.stability | floatformat:-3 }} </td>
        </tr>
    {% endfor %}
</table>
<div style="margin: 10px">
    <a href="/serializer/entry?{{suburl}}&format=json" class="button">Output Result in JSON format</a>
</div>
{% endif %}


<!-- The following function is from www.w3cshools.com/
    Section: 'How TO - Sort a Table'
    The link is https://www.w3schools.com/howto/howto_js_sort_table.asp
-->
<script>
function sortTable(n, type) {
    var table, rows, switching, i, x, y, xc, yc, shouldSwitch, dir, switchcount = 0;
    table = document.getElementById('ResultTable');
    switching = true;

    dir = "asc";

    while (switching) {
        switching = false;
        rows = table.rows;

        for (i = 1; i < (rows.length - 1); i++) {
            shouldswitch = false;

            x = rows[i].getElementsByTagName("TD")[n];
            y = rows[i + 1].getElementsByTagName("TD")[n];

            if (type == 'num') {
                xc = Number(x.innerHTML)
                yc = Number(y.innerHTML)
            } else if (type == 'str') {
                xc = x.innerHTML.toLowerCase()
                yc = y.innerHTML.toLowerCase()
            }


            if (dir == "asc") {
                if (xc > yc){
                    shouldSwitch = true;
                    break;
                }
            } else if (dir == "desc") {
                if (xc < yc){
                    shouldSwitch = true;
                    break;
                }
            }
        }

        if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
            switchcount ++;
        } else {
            if (switchcount == 0 && dir == "asc") {
                dir = "desc";
                switching = true;
            }
        }
    }
}
</script>

</body>

</html>

